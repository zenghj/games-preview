window.__require=function t(o,c,i){function a(n,s){if(!c[n]){if(!o[n]){var r=n.split("/");if(r=r[r.length-1],!o[r]){var l="function"==typeof __require&&__require;if(!s&&l)return l(r,!0);if(e)return e(r,!0);throw new Error("Cannot find module '"+n+"'")}n=r}var h=c[n]={exports:{}};o[n][0].call(h.exports,function(t){return a(o[n][1][t]||t)},h,h.exports,t,o,c,i)}return c[n].exports}for(var e="function"==typeof __require&&__require,n=0;n<i.length;n++)a(i[n]);return a}({block:[function(t,o){"use strict";cc._RF.push(o,"09bb1WqQJtLzolAbQngVtL+","block");var c,i=(c=t("colors"))&&c.__esModule?c:{default:c};cc.Class({extends:cc.Component,properties:{numberLabel:cc.Label},start:function(){},setNumber:function(t){0==t&&(this.numberLabel.node.active=!1),this.numberLabel.string=t,t in i.default&&(this.node.color=i.default[t])}}),cc._RF.pop()},{colors:"colors"}],colors:[function(t,o){"use strict";cc._RF.push(o,"af771+wacZPOqQujfZEpzDc","colors");var c=[];c[0]=cc.color(198,184,172,255),c[2]=cc.color(235,224,213,255),c[4]=cc.color(234,219,193,255),c[8]=cc.color(240,167,110,255),c[16]=cc.color(244,138,89,255),c[32]=cc.color(245,112,85,255),c[64]=cc.color(245,83,52,255),c[128]=cc.color(234,200,103,255),c[256]=cc.color(234,197,87,255),c[512]=cc.color(234,192,71,255),c[1024]=cc.color(146,208,80,255),c[2048]=cc.color(0,176,240,255),o.exports=c,cc._RF.pop()},{}],game:[function(t,o){"use strict";cc._RF.push(o,"65e3c1TSl5CZbglNwxj8KA9","game");var c=[2,4];cc.Class({extends:cc.Component,properties:{scoreLabel:cc.Label,score:0,blockPrefab:cc.Vec2refab,gap:20,bg:cc.Node,gameOverNode:cc.Node},start:function(){window.test=this,this.drawBgBlocks(),this.init(),this.addEventHandler()},drawBgBlocks:function(){this.blockSize=(cc.winSize.width-5*this.gap)/4;var t=this.gap+this.blockSize/2,o=this.blockSize;this.positions=[];for(var c=0;c<4;++c){this.positions.push([0,0,0,0]);for(var i=0;i<4;++i){var a=cc.instantiate(this.blockPrefab);a.width=this.blockSize,a.height=this.blockSize,this.bg.addChild(a),a.setPosition(cc.Vec2(t,o)),this.positions[c][i]={x:t,y:o},t+=this.gap+this.blockSize,a.getComponent("block").setNumber(0)}o+=this.gap+this.blockSize,t=this.gap+this.blockSize/2}},init:function(){if(this.updateScore(0),this.blocks)for(var t=0;t<this.blocks.length;++t)for(var o=0;o<this.blocks[t].length;++o)null!=this.blocks[t][o]&&this.blocks[t][o].destroy();this.data=[],this.blocks=[];for(var c=0;c<4;++c)this.blocks.push([null,null,null,null]),this.data.push([0,0,0,0]);this.addBlock(),this.addBlock(),this.addBlock()},updateScore:function(t){this.score=t,this.scoreLabel.string="\u5206\u6570\uff1a"+t},getEmptyLocations:function(){for(var t=[],o=0;o<this.blocks.length;++o)for(var c=0;c<this.blocks[o].length;++c)null==this.blocks[o][c]&&t.push({x:o,y:c});return t},addBlock:function(){var t=this.getEmptyLocations();if(0==t.length)return!1;var o=t[Math.floor(Math.random()*t.length)],i=o.x,a=o.y,e=this.positions[i][a],n=cc.instantiate(this.blockPrefab);n.width=this.blockSize,n.height=this.blockSize,this.bg.addChild(n),n.setPosition(cc.Vec2(e.x,e.y));var s=c[Math.floor(Math.random()*c.length)];return n.getComponent("block").setNumber(s),this.blocks[i][a]=n,this.data[i][a]=s,!0},addEventHandler:function(){var t=this;this.bg.on("touchstart",function(o){t.startPoint=o.getLocation()}),this.bg.on("touchend",function(o){t.touchEnd(o)}),this.bg.on("touchcancel",function(o){t.touchEnd(o)})},touchEnd:function(t){this.endPoint=t.getLocation();var o=this.endPoint.sub(this.startPoint);o.mag()>50&&(Math.abs(o.x)>Math.abs(o.y)?o.x>0?this.moveRight():this.moveLeft():o.y>0?this.moveUp():this.moveDown())},checkFail:function(){for(var t=0;t<4;++t)for(var o=0;o<4;++o){var c=this.data[t][o];if(0==c)return!1;if(o>0&&this.data[t][o-1]==c)return!1;if(o<3&&this.data[t][o+1]==c)return!1;if(t>0&&this.data[t-1][o]==c)return!1;if(t<3&&this.data[t+1][o]==c)return!1}return!0},gameOver:function(){this.gameOverNode.active=!0},afterMove:function(t){t&&(this.updateScore(this.score+1),this.addBlock()),this.checkFail()&&this.gameOver()},doMove:function(t,o,c){var i=cc.moveTo(.1,o),a=cc.callFunc(function(){c&&c()});t.runAction(cc.sequence(i,a))},doMerge:function(t,o,c,i){t.destroy();var a=cc.scaleTo(.1,1.1),e=cc.scaleTo(.1,1),n=cc.callFunc(function(){o.getComponent("block").setNumber(c)}),s=cc.callFunc(function(){i&&i()});o.runAction(cc.sequence(a,n,e,s))},moveLeft:function(){var t=this;cc.log("move left");for(var o=!1,c=function c(i,a,e){if(0!=a&&0!=t.data[i][a])if(0==t.data[i][a-1]){var n=t.blocks[i][a],s=t.positions[i][a-1];t.blocks[i][a-1]=n,t.data[i][a-1]=t.data[i][a],t.data[i][a]=0,t.blocks[i][a]=null,t.doMove(n,s,function(){c(i,a-1,e)}),o=!0}else{if(t.data[i][a-1]!=t.data[i][a])return void(e&&e());var r=t.blocks[i][a],l=t.positions[i][a-1];t.data[i][a-1]*=2,t.data[i][a]=0,t.blocks[i][a]=null,t.doMove(r,l,function(){t.doMerge(r,t.blocks[i][a-1],t.data[i][a-1],function(){e&&e()})}),o=!0}else e&&e()},i=[],a=0;a<4;++a)for(var e=0;e<4;++e)0!=this.data[a][e]&&i.push({x:a,y:e});for(var n=0,s=0;s<i.length;++s)c(i[s].x,i[s].y,function(){++n==i.length&&t.afterMove(o)})},moveRight:function(){var t=this;cc.log("move right");for(var o=!1,c=function c(i,a,e){if(3!=a&&0!=t.data[i][a])if(0==t.data[i][a+1]){var n=t.blocks[i][a],s=t.positions[i][a+1];t.blocks[i][a+1]=n,t.data[i][a+1]=t.data[i][a],t.data[i][a]=0,t.blocks[i][a]=null,t.doMove(n,s,function(){c(i,a+1,e)}),o=!0}else{if(t.data[i][a+1]!=t.data[i][a])return void(e&&e());var r=t.blocks[i][a],l=t.positions[i][a+1];t.data[i][a+1]*=2,t.data[i][a]=0,t.blocks[i][a]=null,t.doMove(r,l,function(){t.doMerge(r,t.blocks[i][a+1],t.data[i][a+1],function(){e&&e()})}),o=!0}else e&&e()},i=[],a=0;a<4;++a)for(var e=3;e>=0;--e)0!=this.data[a][e]&&i.push({x:a,y:e});for(var n=0,s=0;s<i.length;++s)c(i[s].x,i[s].y,function(){++n==i.length&&t.afterMove(o)})},moveUp:function(){var t=this;cc.log("move up");for(var o=!1,c=function c(i,a,e){if(3!=i&&0!=t.data[i][a])if(0==t.data[i+1][a]){var n=t.blocks[i][a],s=t.positions[i+1][a];t.blocks[i+1][a]=n,t.data[i+1][a]=t.data[i][a],t.data[i][a]=0,t.blocks[i][a]=null,t.doMove(n,s,function(){c(i+1,a,e)}),o=!0}else{if(t.data[i+1][a]!=t.data[i][a])return void(e&&e());var r=t.blocks[i][a],l=t.positions[i+1][a];t.data[i+1][a]*=2,t.data[i][a]=0,t.blocks[i][a]=null,t.doMove(r,l,function(){t.doMerge(r,t.blocks[i+1][a],t.data[i+1][a],function(){e&&e()})}),o=!0}else e&&e()},i=[],a=3;a>=0;--a)for(var e=0;e<4;++e)0!=this.data[a][e]&&i.push({x:a,y:e});for(var n=0,s=0;s<i.length;++s)c(i[s].x,i[s].y,function(){++n==i.length&&t.afterMove(o)})},moveDown:function(){var t=this;cc.log("move down");for(var o=!1,c=function c(i,a,e){if(0!=i&&0!=t.data[i][a])if(0==t.data[i-1][a]){var n=t.blocks[i][a],s=t.positions[i-1][a];t.blocks[i-1][a]=n,t.data[i-1][a]=t.data[i][a],t.data[i][a]=0,t.blocks[i][a]=null,t.doMove(n,s,function(){c(i-1,a,e)}),o=!0}else{if(t.data[i-1][a]!=t.data[i][a])return void(e&&e());var r=t.blocks[i][a],l=t.positions[i-1][a];t.data[i-1][a]*=2,t.data[i][a]=0,t.blocks[i][a]=null,t.doMove(r,l,function(){t.doMerge(r,t.blocks[i-1][a],t.data[i-1][a],function(){e&&e()})}),o=!0}else e&&e()},i=[],a=0;a<4;++a)for(var e=0;e<4;++e)0!=this.data[a][e]&&i.push({x:a,y:e});for(var n=0,s=0;s<i.length;++s)c(i[s].x,i[s].y,function(){++n==i.length&&t.afterMove(o)})},restart:function(){this.init(),this.gameOverNode.active=!1}}),cc._RF.pop()},{}]},{},["block","colors","game"]);